$j.fn.table2CSV=function(e){function t(t){var n=t.join("");if(t.length>0&&""!=n){var i=t.join(e.separator);r[r.length]=i}}function n(e){var t=new RegExp(/["]/g),n=e.replace(t,"â€œ"),t=new RegExp(/\<[^\<]+\>/g),n=n.replace(t,"");return""==n?"":'"'+n+'"'}function i(e){var t=window.open("","csv","height=400,width=800");return t.document.write("<html><head><title>CSV</title>"),t.document.write("</head><body >"),t.document.write('<textArea cols=100 rows=15 wrap="off" >'),t.document.write(e),t.document.write("</textArea>"),t.document.write("</body></html>"),t.document.close(),!0}var e=jQuery.extend({separator:",",header:[],delivery:"popup"},e),r=[],o=[],a=this,h=e.header.length,l=[];if(h>0)for(var d=0;h>d;d++)l[l.length]=n(e.header[d]);else $j(a).filter(":visible").find("th").each(function(){"none"!=$j(this).css("display")&&(l[l.length]=n($j(this).html()))});if(t(l),$j(a).find("tr").each(function(){var e=[];$j(this).filter(":visible").find("td").each(function(){"none"!=$j(this).css("display")&&(e[e.length]=n($j(this).html()))}),t(e)}),"popup"==e.delivery){var c=r.join("\n");return i(c)}var c=r.join("\n");return c};